{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payments Records List</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  } 
</style>


</head>
<body>
  {% include 'sidebar.html' %}

  
  <div class="main" style="min-height: 100vh;" >
    <div class="container " style="margin-top: 100px;">
      {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show text-success" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
      {% endif %}

    <!--  -->
    <script>

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('quotation-management-form').addEventListener('submit', function (e) {
                // Ensure all calculations are up-to-date before submission

                calculateTotal();

                // You can add additional validation here if needed
                if (selectedProducts.length === 0) {

                    alert('Please select at least one product');
                    e.preventDefault();
                    return;
                }
            });
        });



        document.addEventListener("DOMContentLoaded", function () {
            const menuItems = document.querySelectorAll('.sidebar ul li.has-submenu');
            menuItems.forEach(item => {
                item.addEventListener('click', function () {
                    const submenu = this.querySelector('.submenu');
                    const arrow = this.querySelector('.arrow-down');

                    // Hide all other submenus
                    menuItems.forEach(otherItem => {
                        if (otherItem !== this) {
                            const otherSubmenu = otherItem.querySelector('.submenu');
                            const otherArrow = otherItem.querySelector('.arrow-down');
                            if (otherSubmenu) {
                                otherSubmenu.style.display = 'none';
                                if (otherArrow.classList.contains('arrow-up')) {
                                    otherArrow.classList.remove('arrow-up');
                                }
                            }
                        }
                    });


                    // Toggle current submenu
                    if (submenu) {
                        submenu.style.display = (submenu.style.display === 'block' ? 'none' : 'block');
                        arrow.classList.toggle('arrow-up');
                    }
                });
            });
        });
    </script>

      
      <div class="row ">
        <div class="col-md-2"></div>
        <div class="col-md-8 bg-white p-2 rounded shadow mb-4">
                      <div class="bt">
                <span onclick="window.location.href='/index'" style="float: left; cursor: pointer; color:rgb(75, 162, 255); font-size:20px;" class="mb-4 mt-2"><i class="fas fa-house-chimney"></i></span>
                <span onclick="goBackAndRefresh()" style="float: right; cursor: pointer; color:red; font-size:20px;" class="mb-4 mt-2">X</span>
            </div>
      <form method="post">
        {% csrf_token %}
        <h3 class="text-center mt-2">Payment records</h3>
        <div class="row">

       
         <div class="col-md-6">
                    <label class="form-label">Invoice No <span class="star">*</span></label>
          <input type="text" id="invoice_no" class="w-100" name="main_invoice" onblur="fetchInvoice()">
      
         </div>
         <div class="col-md-6">
                    <label class="form-label">Customer Name</label>
          <input type="text" id="customer_name" class="form-control" readonly>
        
         </div>
         <div class="col-md-6">
                    <label class="form-label">Mobile No</label>
          <input type="text" id="customer_mobile" class="form-control" readonly>
        
         </div>
         <div class="col-md-6">
                    <label class="form-label">Email</label>
          <input type="text" id="customer_email" class="form-control" readonly>
        
         </div>
         <div class="col-md-6">
                    <label class="form-label">Total Amount</label>
          <input type="text" id="total_amount" name="total_amount" class="form-control" readonly>

         </div>
         <div class="col-md-6">
                    <label class="form-label">Remaining Amount</label>
          <input class="form-control" type="text" id="amount_remaining" readonly>
      
         </div>
         <div class="col-md-6">
                    <label  class="form-label">Amount Paid <span class="star">*</span></label>
          <input class="form-control" type="number" name="amount_paid" step="any" required>
      
         </div>
         <div class="col-md-6">
                    <label  class="form-label">Payment Date <span class="star">*</span></label>
          <input class="form-control" type="date" name="payment_date" required>
      
         </div>
         <div class="col-md-6">
          
          <label  class="form-label">Next Due Date</label>
          <input class="form-control" type="date" name="next_due_date" >
      
         </div>
         <div class="col-md-6">
                    <label  class="form-label">Previous Due Date</label>
          <input class="form-control" type="date" name="previous_due_date" >
      
         </div>
         <div class="col-md-6">
                    <label  class="form-label">Work type <span class="star">*</span></label>
          <input class="form-control" type="text" name="work_type" placeholder="Enter work type" >
      
         </div>
         <div class="col-md-6">
                    <label  class="form-label">Payment details</label>
          <input class="form-control" type="text" name="Payment_details" placeholder="Enter Payment Details" >
      
         </div>
         <div class="col-md-6">
                              <label  class="form-label">Select Payment Mode <span class="star">*</span></label>

                    <select name="payment_mode" class="form-select" required>
            <option value="">-- Select Payment Mode --</option>
            {% for value, label in payment_choices %}
            <option value="{{ value }}">{{ label }}</option>
            {% endfor %}
          </select>
         </div>
         
         <div class="col-md-6">
                    <label class="form-label">Payment Rating</label>
          <select name="payment_rating" class="form-select">
            <option value="">-- Select Rating --</option>
            {% for val, label in payment_ratings %}
              <option value="{{ val }}">{{ label }}</option>
            {% endfor %}
          </select>
         </div>

         <div class="col-md-6">
                    <label  class="form-label">Upload Payment Attachment</label>
          <input class="form-control" type="file" name="Payment_attachment" >
         </div>
 

         <div class="col-md-6">
                    <label class="form-label">Remarks</label>
          <textarea name="remarks" class="form-control" rows="2" placeholder="Enter Remarks"></textarea>
      
         </div>








      

      


    
  <div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-4">
              <button type="submit" class="btn btn-primary w-100 mt-3 mb-3">Submit</button>

    </div>
    <div class="col-md-4"></div>
  </div>
         </div>
      </form>

      </div>
        <div class="col-md-2"></div>
      </div>
    </div>


  </div>
  <div class="container-fluid footer" style="background-color: #f7f7f7; width:100%;">
    <div class="row p-3">
      <div class="col-md-12 text-center">
        <p style="margin: 0; font-weight: 600; color:#000000">
          © 2025. Powered by
          <img src="{% static 'images/crono.png' %}" alt="Chronoanalytics Logo"
            style="height: 20px; vertical-align: middle;">
          <a href="http://www.chronoanalytics.in/"
            style="text-decoration: none; background: linear-gradient(to right, #2575fc, #6a11cb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 1.1rem;">Chronoanalytics
            Solution</a>
          All Rights Reserved.
        </p>
      </div>
      <div class="col-md-12 text-center">
        <p style="font-weight: 600; color:#000000">
          © 2025. Marketed by
          <img src="{% static 'images/TeimLogo.png' %}" alt="Teim Logo" style="height: 20px; vertical-align: middle;">
          <a href="http://teim.in/"
            style="text-decoration: none; background: linear-gradient(to right, #2575fc, #6a11cb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 1.1rem;">TEIM</a>
          All Rights Reserved.
        </p>
      </div>
    </div>
  </div>











<!-- This is for invoice details -->
<script>
  function fetchInvoice() {
    const invoiceNo = document.getElementById('invoice_no').value;

    fetch("{% url 'fetch_invoice' %}", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
        "X-CSRFToken": "{{ csrf_token }}"
      },
      body: new URLSearchParams({
        "invoice_no": invoiceNo
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        document.getElementById('customer_name').value = data.fullname;
        document.getElementById('customer_mobile').value = data.mobile;
        document.getElementById('customer_email').value = data.email;
        document.getElementById('total_amount').value = data.total_amount;
        document.getElementById('amount_remaining').value = data.amount_remaining;
      } else {
        alert(data.error);
      }
    })
    .catch(error => {
      console.error("Error fetching invoice:", error);
    });
  }
</script>


  <!-- <script>
    document.addEventListener("DOMContentLoaded", function () {
      const menuItems = document.querySelectorAll('.sidebar ul li.has-submenu');
      menuItems.forEach(item => {
        item.addEventListener('click', function () {
          const submenu = this.querySelector('.submenu');
          const arrow = this.querySelector('.arrow-down');

          // Hide all other submenus
          menuItems.forEach(otherItem => {
            if (otherItem !== this) {
              const otherSubmenu = otherItem.querySelector('.submenu');
              const otherArrow = otherItem.querySelector('.arrow-down');
              if (otherSubmenu) {
                otherSubmenu.style.display = 'none';
                if (otherArrow.classList.contains('arrow-up')) {
                  otherArrow.classList.remove('arrow-up');
                }
              }
            }
          });

          // Toggle current submenu
          if (submenu) {
            submenu.style.display = (submenu.style.display === 'block' ? 'none' : 'block');
            arrow.classList.toggle('arrow-up');
          }
        });
      });
    });
    
  </script> -->

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

</body>
</html>